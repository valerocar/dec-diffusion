(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     48476,       1166]
NotebookOptionsPosition[     45960,       1118]
NotebookOutlinePosition[     46387,       1135]
CellTagsIndexPosition[     46344,       1132]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Effective Diffusion for  Channels on the Plane", "Title",
 CellChangeTimes->{{3.784104272074313*^9, 
  3.7841043123305187`*^9}},ExpressionUUID->"86c4c0b2-3f54-4eda-bbad-\
517274eb7bb9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"nb", "=", 
   RowBox[{"NotebookOpen", "[", 
    RowBox[{"StringJoin", "[", 
     RowBox[{
      RowBox[{"NotebookDirectory", "[", "]"}], ",", "\"\<Base2D.nb\>\""}], 
     "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NotebookEvaluate", "[", "nb", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"NotebookClose", "[", "nb", "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.784714151397924*^9, 3.784714248050672*^9}, {
   3.7847143100898123`*^9, 3.784714637121785*^9}, 3.784714687116843*^9, 
   3.7847147590362253`*^9, {3.7847150103560143`*^9, 3.784715011203603*^9}, {
   3.7847150510971317`*^9, 3.784715062619286*^9}, 3.784716990048596*^9},
 CellLabel->"In[1]:=",ExpressionUUID->"4146c56b-6109-4f1d-bc55-ce221a744420"],

Cell[CellGroupData[{

Cell["Finding harmonic coordinates and level sets", "Chapter",
 CellChangeTimes->{{3.783755896142235*^9, 3.7837559633144913`*^9}, {
  3.784209420776712*^9, 
  3.7842094231722193`*^9}},ExpressionUUID->"319bfe9c-5b5b-46fb-93fc-\
c56fe8db3e2e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ex0", "=", 
   RowBox[{"{", 
    RowBox[{"x", ",", 
     RowBox[{"x", "-", "1"}], ",", "y", ",", 
     RowBox[{"y", "-", 
      RowBox[{"1", "/", "2"}]}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ex1", "=", 
   RowBox[{"{", 
    RowBox[{"x", ",", 
     RowBox[{"x", "-", "2.5"}], ",", 
     RowBox[{"y", "-", 
      RowBox[{".6", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Sin", "[", 
          RowBox[{"5", "x"}], "]"}], "/", "3"}], ")"}]}]}], ",", 
     RowBox[{"y", "-", 
      RowBox[{"1", "/", "2"}], "+", 
      RowBox[{".5", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Sin", "[", 
          RowBox[{"2", 
           RowBox[{"(", "x", ")"}]}], "]"}], "/", "2"}], ")"}]}]}]}], "}"}]}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ex2", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"ArcTan", "[", 
        RowBox[{"x", ",", "y"}], "]"}], "+", "Pi"}], ",", " ", 
      RowBox[{
       RowBox[{"ArcTan", "[", 
        RowBox[{"x", ",", "y"}], "]"}], "-", 
       RowBox[{"Pi", "/", "2"}]}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"x", "-", ".3"}], ")"}], "^", "2"}], "+", 
       RowBox[{
        RowBox[{"(", "y", ")"}], "^", "2"}], "-", "1"}], ",", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"x", "/", "1.5"}], ")"}], "^", "2"}], "+", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"y", "/", "1.5"}], ")"}], "^", "2"}], "-", "1"}]}], "}"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ex3", "=", 
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"x", "/", ".5"}], ")"}], "^", "2"}], "+", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"y", "/", ".5"}], ")"}], "^", "2"}], "-", "1"}], ",", " ", 
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"x", "/", "1.5"}], ")"}], "^", "2"}], "+", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"y", "/", "1.5"}], ")"}], "^", "2"}], "-", "1"}], ",", 
      RowBox[{"ArcTan", "[", 
       RowBox[{"x", ",", "y"}], "]"}], ",", " ", 
      RowBox[{
       RowBox[{"ArcTan", "[", 
        RowBox[{"x", ",", "y"}], "]"}], "-", 
       RowBox[{"Pi", "/", "8"}]}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"sz", "=", "3.5"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"box", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"-", "sz"}], ",", "sz", ",", 
     RowBox[{"-", "sz"}], ",", "sz"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ex", " ", "=", " ", "ex1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"mesh", ",", "\[Phi]"}], "}"}], "=", 
   RowBox[{"harmonicData", "[", 
    RowBox[{"ex", ",", "box", ",", ".0002", ",", "1"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Phi]x", "=", 
   RowBox[{
    RowBox[{"Derivative", "[", 
     RowBox[{"1", ",", "0"}], "]"}], "[", "\[Phi]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Phi]y", "=", 
   RowBox[{
    RowBox[{"Derivative", "[", 
     RowBox[{"0", ",", "1"}], "]"}], "[", "\[Phi]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"g\[Phi]", "[", 
     RowBox[{"x_", ",", "y_"}], "]"}], ":=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\[Phi]x", "[", 
       RowBox[{"x", ",", "y"}], "]"}], ",", 
      RowBox[{"\[Phi]y", "[", 
       RowBox[{"x", ",", "y"}], "]"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Show", "[", 
    RowBox[{
     RowBox[{"mesh", "[", "\"\<Wireframe\>\"", "]"}], ",", 
     RowBox[{"Axes", "\[Rule]", "True"}]}], "]"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"mesh", "[", "\"\<Wireframe\>\"", "]"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"Plot3D", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"\[Phi]x", "[", 
        RowBox[{"x", ",", "y"}], "]"}], ",", 
       RowBox[{"\[Phi]y", "[", 
        RowBox[{"x", ",", "y"}], "]"}], ",", 
       RowBox[{"\[Phi]", "[", 
        RowBox[{"x", ",", "y"}], "]"}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"x", ",", "y"}], "}"}], "\[Element]", "mesh"}], ",", 
     RowBox[{"Mesh", "\[Rule]", "None"}], ",", 
     RowBox[{"NormalsFunction", "\[Rule]", "None"}], ",", 
     RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"us", ",", " ", "dus", ",", " ", "Sus"}], "}"}], "=", 
   RowBox[{"getLevelSets", "[", 
    RowBox[{"\[Phi]", ",", "mesh", ",", "0", ",", "1", ",", ".01"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"uMin", "=", 
   RowBox[{"Min", "[", "us", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"uMax", "=", 
   RowBox[{"Max", "[", "us", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"uDomain", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{"u", ",", "uMin", ",", "uMax"}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"lG", "=", 
   RowBox[{"ListPlot", "[", 
    RowBox[{"Sus", ",", 
     RowBox[{"Joined", "\[Rule]", "True"}], ",", 
     RowBox[{"PlotStyle", "\[Rule]", 
      RowBox[{"Directive", "[", 
       RowBox[{
        RowBox[{"Thickness", "[", ".001", "]"}], ",", "Black"}], "]"}]}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Epsilon]", "=", ".001"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"lW", " ", "=", " ", 
    RowBox[{"ContourPlot", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"ex", "[", 
          RowBox[{"[", "3", "]"}], "]"}], "\[Equal]", "\[Epsilon]"}], ",", 
        RowBox[{
         RowBox[{"ex", "[", 
          RowBox[{"[", "4", "]"}], "]"}], "\[Equal]", 
         RowBox[{"-", "\[Epsilon]"}]}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"x", ",", "0", ",", "2.5"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"y", ",", 
        RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", 
      RowBox[{"PlotPoints", "\[Rule]", "100"}], ",", 
      RowBox[{"ContourStyle", "\[Rule]", 
       RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"sG", "=", 
     RowBox[{"StreamPlot", "[", 
      RowBox[{
       RowBox[{"g\[Phi]", "[", 
        RowBox[{"x", ",", "y"}], "]"}], ",", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x", ",", "y"}], "}"}], "\[Element]", "mesh"}], ",", 
       RowBox[{"StreamPoints", "\[Rule]", "Fine"}]}], "]"}]}], ";"}], "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Length", "[", "Sus", "]"}], "==", 
     RowBox[{"Length", "[", "us", "]"}]}], ",", " ", 
    RowBox[{"Print", "[", "\"\<Level curves OK!\>\"", "]"}], ",", " ", 
    RowBox[{"Print", "[", "\"\<Faulty Level curves, Correcting!\>\"", "]"}]}],
    "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Sus", "=", 
    RowBox[{"Select", "[", 
     RowBox[{"Sus", ",", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "#", "]"}], ">", "2"}], "&"}]}], "]"}]}], 
   ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"Removing", " ", "Faulty", " ", "Curves"}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Length", "[", "Sus", "]"}], "==", 
     RowBox[{"Length", "[", "us", "]"}]}], ",", " ", 
    RowBox[{"Print", "[", "\"\<Level curves OK!\>\"", "]"}], ",", " ", 
    RowBox[{
    "Print", "[", "\"\<Faulty Level curves, Check criteria!\>\"", "]"}]}], 
   "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Show", "[", 
  RowBox[{"lW", ",", "lG", ",", 
   RowBox[{"Axes", "\[Rule]", "False"}], ",", 
   RowBox[{"AspectRatio", "->", "Automatic"}]}], 
  "]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.783778458926194*^9, 3.7837785459383*^9}, {
   3.78377858510693*^9, 3.783778768089818*^9}, {3.7837788043010406`*^9, 
   3.783778957306271*^9}, {3.7837789966845207`*^9, 3.783779002946706*^9}, {
   3.783779084787406*^9, 3.7837792980810747`*^9}, {3.783779328451028*^9, 
   3.7837793697221518`*^9}, 3.783779452427865*^9, {3.783779501107774*^9, 
   3.7837796548498573`*^9}, {3.783779979627482*^9, 3.7837800337456303`*^9}, {
   3.783780076923181*^9, 3.783780169704973*^9}, {3.783780215515251*^9, 
   3.78378053882384*^9}, {3.783780689401575*^9, 3.783780882045704*^9}, {
   3.783780927265366*^9, 3.783780976789865*^9}, {3.783781053346197*^9, 
   3.783781179918878*^9}, {3.7837812822114267`*^9, 3.783781473261051*^9}, {
   3.783781540104248*^9, 3.783781603884776*^9}, {3.783781672152439*^9, 
   3.783781767485824*^9}, {3.783781859758556*^9, 3.783781893933475*^9}, 
   3.783781928801538*^9, {3.783782001653964*^9, 3.7837820915735607`*^9}, {
   3.7837821614796867`*^9, 3.78378223366919*^9}, {3.783782302903718*^9, 
   3.783782312885076*^9}, {3.783782345543458*^9, 3.783782419055358*^9}, {
   3.783782456030971*^9, 3.7837824868648787`*^9}, {3.783782522398881*^9, 
   3.783782524572537*^9}, {3.783844985165868*^9, 3.783845021931758*^9}, 
   3.7838450555260077`*^9, {3.783845125394981*^9, 3.783845264975531*^9}, {
   3.7838452979511557`*^9, 3.783845558395051*^9}, {3.7838455991144533`*^9, 
   3.78384563068891*^9}, {3.783845692996834*^9, 3.783845719211269*^9}, {
   3.783845754778882*^9, 3.783845781413542*^9}, {3.783845863706345*^9, 
   3.783845886556388*^9}, {3.783845984053979*^9, 3.783846114703511*^9}, {
   3.7838461892122383`*^9, 3.7838462152985487`*^9}, {3.783846290909165*^9, 
   3.783846334157126*^9}, {3.7838464594702663`*^9, 3.783846460906765*^9}, 
   3.7838465039091167`*^9, {3.783846574540269*^9, 3.783846607577491*^9}, {
   3.7838466750387993`*^9, 3.7838467248204107`*^9}, {3.783846767332225*^9, 
   3.7838467674153433`*^9}, {3.783846845721531*^9, 3.783846846129784*^9}, {
   3.783846892521386*^9, 3.783846893767984*^9}, {3.7838469509454117`*^9, 
   3.78384699206362*^9}, {3.783847031791057*^9, 3.783847079623246*^9}, {
   3.783847144884344*^9, 3.7838471464617853`*^9}, {3.783847186016079*^9, 
   3.783847186100606*^9}, 3.7838912688339033`*^9, {3.783902910667294*^9, 
   3.7839029143345423`*^9}, {3.783903088469801*^9, 3.783903088557797*^9}, {
   3.78390314231149*^9, 3.78390314276715*^9}, {3.783903179083593*^9, 
   3.7839032075754023`*^9}, {3.783903254884061*^9, 3.7839032762959146`*^9}, {
   3.783903484005987*^9, 3.7839035064898663`*^9}, {3.7839035392297087`*^9, 
   3.783903539297307*^9}, {3.783903881493671*^9, 3.783903882013089*^9}, {
   3.7839046662576942`*^9, 3.7839046663313837`*^9}, {3.783904740168762*^9, 
   3.783904740331614*^9}, {3.783904791473908*^9, 3.783904791595685*^9}, {
   3.783904831233802*^9, 3.783904860337227*^9}, {3.783904917123527*^9, 
   3.78390491745469*^9}, {3.783905012561111*^9, 3.7839050136991243`*^9}, {
   3.7839051500406923`*^9, 3.7839051579271173`*^9}, {3.7839052968927717`*^9, 
   3.7839052978538523`*^9}, {3.783905367728915*^9, 3.783905384695714*^9}, {
   3.783906096599646*^9, 3.783906100185505*^9}, {3.783906218009983*^9, 
   3.783906221506485*^9}, {3.7839062922459717`*^9, 3.783906294623622*^9}, {
   3.783906351216256*^9, 3.783906352388335*^9}, {3.783906413997344*^9, 
   3.783906415084594*^9}, {3.783906448585216*^9, 3.783906484475357*^9}, {
   3.7839065169150267`*^9, 3.783906545896515*^9}, {3.783906621665402*^9, 
   3.783906649489077*^9}, {3.783906698293654*^9, 3.7839067055064373`*^9}, {
   3.7839067462924232`*^9, 3.783906842809688*^9}, {3.783906910766076*^9, 
   3.783906945429839*^9}, {3.783906978479177*^9, 3.783906978970262*^9}, 
   3.783907235913414*^9, {3.783907276821159*^9, 3.783907313982389*^9}, {
   3.783907402614539*^9, 3.7839074041719933`*^9}, {3.783907439312828*^9, 
   3.783907440564311*^9}, {3.78390749361567*^9, 3.7839075546368017`*^9}, {
   3.7839075904820642`*^9, 3.783907619204348*^9}, {3.783907661700947*^9, 
   3.783907672700221*^9}, {3.783907709612197*^9, 3.783907749417527*^9}, {
   3.7839078604001827`*^9, 3.783907974808247*^9}, {3.7840196957375317`*^9, 
   3.784019699218326*^9}, {3.7840197563361464`*^9, 3.784019773806471*^9}, {
   3.784019845272479*^9, 3.784019870847666*^9}, {3.784019902794649*^9, 
   3.7840199058193817`*^9}, {3.7840204717480793`*^9, 
   3.7840204759031057`*^9}, {3.78402093727551*^9, 3.784020939965839*^9}, {
   3.784021016918968*^9, 3.7840210636341667`*^9}, {3.784021370429751*^9, 
   3.784021481721051*^9}, {3.784021517506825*^9, 3.784021523090189*^9}, {
   3.7840215567337313`*^9, 3.7840215985556793`*^9}, 3.784021980521392*^9, {
   3.784022035153819*^9, 3.784022154968762*^9}, {3.7840222297682953`*^9, 
   3.784022282358551*^9}, {3.7840223129919453`*^9, 3.7840224010895433`*^9}, {
   3.784022437670209*^9, 3.784022438127184*^9}, {3.7840224787060003`*^9, 
   3.784022479875586*^9}, {3.784022789014937*^9, 3.784023008117003*^9}, 
   3.78402305220148*^9, 3.784039605156293*^9, {3.784102349985046*^9, 
   3.784102497740308*^9}, {3.784103005493207*^9, 3.784103020285507*^9}, {
   3.7841033353697557`*^9, 3.784103408254287*^9}, {3.784103657499968*^9, 
   3.7841037885458927`*^9}, {3.7841038307523947`*^9, 3.784103840331829*^9}, {
   3.784103890705833*^9, 3.784103921972947*^9}, {3.784104128444641*^9, 
   3.784104129301763*^9}, 3.784122641392344*^9, {3.784123382219077*^9, 
   3.784123390421178*^9}, {3.784123615761574*^9, 3.7841236513147707`*^9}, {
   3.784140913103005*^9, 3.784140914789114*^9}, {3.7841409561287107`*^9, 
   3.7841409711464357`*^9}, {3.784141367499975*^9, 3.784141367773707*^9}, {
   3.784152608206799*^9, 3.7841526087560787`*^9}, 3.784152690016103*^9, {
   3.784153779625265*^9, 3.784153782086694*^9}, {3.784154274663974*^9, 
   3.7841542904282722`*^9}, {3.784154338267301*^9, 3.784154348592372*^9}, 
   3.7841543839692917`*^9, {3.784154446708926*^9, 3.7841544474810677`*^9}, {
   3.784156135630992*^9, 3.784156135867545*^9}, {3.784156212473525*^9, 
   3.784156212751815*^9}, {3.784158098935582*^9, 3.784158128611546*^9}, {
   3.784158160164587*^9, 3.784158190279873*^9}, {3.7841584297162743`*^9, 
   3.784158441275937*^9}, {3.784165928617723*^9, 3.7841659309235477`*^9}, {
   3.7841660473838587`*^9, 3.784166051057324*^9}, {3.7841663824371634`*^9, 
   3.7841664426667356`*^9}, {3.78416709975152*^9, 3.784167100080254*^9}, {
   3.7841672069242077`*^9, 3.7841672074501038`*^9}, 3.7841932331545067`*^9, {
   3.784193286067079*^9, 3.784193331639312*^9}, {3.784193408976499*^9, 
   3.784193411324953*^9}, {3.7841934585285378`*^9, 3.7841935174647017`*^9}, {
   3.784193548550609*^9, 3.784193550032898*^9}, {3.784193660148341*^9, 
   3.784193754358284*^9}, {3.7841939644506903`*^9, 3.784194224786962*^9}, {
   3.784194330007859*^9, 3.784194389273953*^9}, {3.784194449614139*^9, 
   3.7841945008239613`*^9}, {3.784194534331778*^9, 3.784194693560184*^9}, {
   3.7841948173046417`*^9, 3.7841948174673843`*^9}, {3.784194883800138*^9, 
   3.784194891324108*^9}, {3.7841949771140137`*^9, 3.784194997815488*^9}, {
   3.784195043617279*^9, 3.7841950611285458`*^9}, {3.784204058826676*^9, 
   3.784204071705186*^9}, {3.78420868945925*^9, 3.784208689583227*^9}, {
   3.784208760006885*^9, 3.784208816824977*^9}, {3.7842088649774923`*^9, 
   3.7842088829537983`*^9}, {3.7842089193810787`*^9, 3.784208953633519*^9}, {
   3.7842091620574417`*^9, 3.784209205373384*^9}, {3.784209436690587*^9, 
   3.784209509707612*^9}, {3.78427668452219*^9, 3.784276735840474*^9}, {
   3.784276773807549*^9, 3.784276774204801*^9}, {3.784276949249465*^9, 
   3.784276958925321*^9}, {3.784277000367797*^9, 3.784277130730516*^9}, {
   3.78427753832927*^9, 3.784277556041853*^9}, {3.784321727863574*^9, 
   3.784321727971099*^9}, {3.784321836470035*^9, 3.784321914947062*^9}, {
   3.784324475097972*^9, 3.78432451960254*^9}, {3.784324550818707*^9, 
   3.784324550898796*^9}, {3.784463350460343*^9, 3.7844634066661863`*^9}, {
   3.7844816830909853`*^9, 3.784481713825799*^9}, {3.784503151450532*^9, 
   3.7845031578499327`*^9}, {3.784503911588975*^9, 3.78450392447696*^9}, {
   3.784506458615014*^9, 3.784506458701988*^9}, {3.7845065707282143`*^9, 
   3.784506575734548*^9}, 3.7845066673597383`*^9, {3.784506764431328*^9, 
   3.7845067645512667`*^9}, {3.784509005464219*^9, 3.78450900555869*^9}, {
   3.784509044648614*^9, 3.78450904479937*^9}, {3.784509363177194*^9, 
   3.784509371568108*^9}, {3.784509904555223*^9, 3.7845099690347357`*^9}, {
   3.7845100308282824`*^9, 3.7845100734753237`*^9}, {3.784510226717359*^9, 
   3.784510292580162*^9}, {3.7845103264858007`*^9, 3.784510328612206*^9}, {
   3.784510424566709*^9, 3.784510490398266*^9}, {3.784510547182829*^9, 
   3.784510565133603*^9}, {3.78451086620784*^9, 3.7845110116551733`*^9}, {
   3.7845381661685257`*^9, 3.78453822436378*^9}, {3.784538319710393*^9, 
   3.7845383340392523`*^9}, {3.784538514202991*^9, 3.784538526292233*^9}, {
   3.784539687969513*^9, 3.784539720089645*^9}, {3.784568357591392*^9, 
   3.784568376382222*^9}, {3.78456850263888*^9, 3.784568514207234*^9}, {
   3.784568622045438*^9, 3.784568622126927*^9}, 3.7845690660306053`*^9, {
   3.784569136898468*^9, 3.784569173428788*^9}, {3.7845692271271*^9, 
   3.784569274705935*^9}, {3.784569336712517*^9, 3.7845693787390347`*^9}, {
   3.784715138952693*^9, 3.784715164960505*^9}, {3.7847152196433773`*^9, 
   3.7847152713850803`*^9}, {3.784715303406398*^9, 3.784715303505316*^9}, {
   3.7847154172196198`*^9, 3.784715417293939*^9}, 3.78471698550082*^9, {
   3.784717458859714*^9, 3.7847174714845963`*^9}, {3.7847176067889843`*^9, 
   3.784717618589178*^9}, {3.784717704514947*^9, 3.784717713143661*^9}, {
   3.784718767130691*^9, 3.7847187891038637`*^9}, {3.78494068551505*^9, 
   3.784940685692401*^9}, {3.784940727866431*^9, 3.784940727956122*^9}, {
   3.784940821016343*^9, 3.7849408858362293`*^9}, {3.784940926299066*^9, 
   3.784940960261753*^9}, {3.7849411408780193`*^9, 3.784941140965316*^9}, {
   3.784941215315197*^9, 3.784941242731427*^9}, {3.784941332131576*^9, 
   3.7849413355426407`*^9}, {3.784941382030492*^9, 3.784941382118672*^9}, {
   3.7849414561586246`*^9, 3.784941456658698*^9}, {3.786219865729693*^9, 
   3.78621990770829*^9}, {3.786391293412294*^9, 3.7863913084880657`*^9}, {
   3.7863913954763327`*^9, 3.7863914287006083`*^9}, {3.786391474512286*^9, 
   3.786391662086938*^9}, {3.7863916948582497`*^9, 3.7863921142100897`*^9}, {
   3.7863923636273518`*^9, 3.786392393101962*^9}, {3.786994580228902*^9, 
   3.786994580478278*^9}},
 CellLabel->"In[4]:=",ExpressionUUID->"348b3181-cd68-4997-9e0c-52fee9878f96"],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.784715482325363*^9, 3.784715482940145*^9}, {
   3.7847155204190283`*^9, 3.784715532531296*^9}, {3.784715595891779*^9, 
   3.784715625490314*^9}, 
   3.7847169497030897`*^9},ExpressionUUID->"c899a049-9595-4588-8a25-\
007a50fbb0a3"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Computing J", "Chapter",
 CellChangeTimes->{{3.784209406821064*^9, 3.7842094150817413`*^9}, 
   3.784209519722971*^9},ExpressionUUID->"e3f1f768-6778-468d-95cc-\
d4f372f10f4d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"g\[Phi]s", "=", 
   RowBox[{
    RowBox[{"fieldFlux", "[", "g\[Phi]", "]"}], "/@", "Sus"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"J", "=", 
   RowBox[{"Mean", "[", "g\[Phi]s", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Show", "[", 
  RowBox[{
   RowBox[{"ListPlot", "[", 
    RowBox[{"{", "g\[Phi]s", "}"}], "]"}], ",", 
   RowBox[{"Plot", "[", 
    RowBox[{"J", ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "Sus", "]"}]}], "}"}], ",", 
     RowBox[{"PlotStyle", "\[Rule]", "Red"}]}], "]"}]}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Print", "[", 
  RowBox[{"\"\<J = mean(Js) : \>\"", ",", "J"}], "]"}], "\[IndentingNewLine]", 
 RowBox[{"Print", "[", 
  RowBox[{"\"\<sdev(Js): \>\"", ",", 
   RowBox[{"StandardDeviation", "[", "g\[Phi]s", "]"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.7841395503788157`*^9, 3.784139658329977*^9}, {
   3.784139688607226*^9, 3.7841400275824347`*^9}, 3.7841401343876133`*^9, {
   3.7841407877002363`*^9, 3.784140788057815*^9}, {3.784140830369913*^9, 
   3.784140883544149*^9}, 3.7842094038440228`*^9, 3.784232810986661*^9},
 CellLabel->"In[26]:=",ExpressionUUID->"68c1bf9b-3f72-46ff-b1ad-edb5a213e6ea"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Computing \[Sigma] and \[Nu]", "Chapter",
 CellChangeTimes->{{3.7845040728626347`*^9, 3.7845040915965652`*^9}, 
   3.78471725583526*^9},ExpressionUUID->"8ba35778-5ed7-4261-a28b-\
eb791355ca7e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"g\[Phi]Sq", "[", 
   RowBox[{"x_", ",", "y_"}], "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{
     RowBox[{"\[Phi]x", "[", 
      RowBox[{"x", ",", "y"}], "]"}], "^", "2"}], "+", 
    RowBox[{
     RowBox[{"\[Phi]y", "[", 
      RowBox[{"x", ",", "y"}], "]"}], "^", "2"}]}], 
   ")"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"U", "[", 
    RowBox[{"x_", ",", "y_"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"\[Phi]x", "[", 
       RowBox[{"x", ",", "y"}], "]"}], "/", 
      RowBox[{"g\[Phi]Sq", "[", 
       RowBox[{"x", ",", "y"}], "]"}]}], ",", 
     RowBox[{
      RowBox[{"\[Phi]y", "[", 
       RowBox[{"x", ",", "y"}], "]"}], "/", 
      RowBox[{"g\[Phi]Sq", "[", 
       RowBox[{"x", ",", "y"}], "]"}]}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"V", "[", 
    RowBox[{"x_", ",", "y_"}], "]"}], ":=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{"\[Phi]", "[", 
       RowBox[{"x", ",", "y"}], "]"}], 
      RowBox[{
       RowBox[{"\[Phi]x", "[", 
        RowBox[{"x", ",", "y"}], "]"}], "/", 
       RowBox[{"g\[Phi]Sq", "[", 
        RowBox[{"x", ",", "y"}], "]"}]}]}], ",", 
     RowBox[{
      RowBox[{"\[Phi]", "[", 
       RowBox[{"x", ",", "y"}], "]"}], 
      RowBox[{
       RowBox[{"\[Phi]y", "[", 
        RowBox[{"x", ",", "y"}], "]"}], "/", 
       RowBox[{"g\[Phi]Sq", "[", 
        RowBox[{"x", ",", "y"}], "]"}]}]}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Sigma]s", "=", 
   RowBox[{
    RowBox[{"fieldFlux", "[", "U", "]"}], "/@", "Sus"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Nu]s", "=", 
   RowBox[{"Accumulate", "[", 
    RowBox[{"\[Sigma]s", " ", "dus"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ls", "=", 
   RowBox[{"curveLength", "/@", "Sus"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Sigma]", "=", 
   RowBox[{"interpolate", "[", 
    RowBox[{"us", ",", "\[Sigma]s"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Nu]", "=", 
   RowBox[{"interpolate", "[", 
    RowBox[{"us", ",", "\[Nu]s"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"l", "=", 
   RowBox[{"interpolate", "[", 
    RowBox[{"us", ",", "ls"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Plot", "[", 
  RowBox[{
   RowBox[{"\[Nu]", "[", "u", "]"}], ",", "uDomain", ",", 
   RowBox[{"PlotRange", "\[Rule]", "All"}], ",", " ", 
   RowBox[{"PlotLabels", "\[Rule]", "\"\<Expressions\>\""}]}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Plot", "[", 
  RowBox[{
   RowBox[{"\[Sigma]", "[", "u", "]"}], ",", "uDomain", ",", 
   RowBox[{"PlotRange", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"0", ",", 
      RowBox[{"1.2", " ", 
       RowBox[{"Max", "[", "\[Sigma]s", "]"}]}]}], "}"}]}], ",", " ", 
   RowBox[{"PlotLabels", "\[Rule]", "\"\<Expressions\>\""}]}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Plot", "[", 
  RowBox[{
   RowBox[{"l", "[", "u", "]"}], ",", "uDomain", ",", 
   RowBox[{"PlotRange", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"0", ",", 
      RowBox[{"1.1", 
       RowBox[{"Max", "[", "ls", "]"}]}]}], "}"}]}], ",", " ", 
   RowBox[{"PlotLabels", "\[Rule]", "\"\<Expressions\>\""}]}], 
  "]"}]}], "Input",
 CellChangeTimes->{
  3.784169252951303*^9, {3.784169738095149*^9, 3.7841698075181627`*^9}, {
   3.7841698388338118`*^9, 3.7841700993040543`*^9}, 3.784209556408023*^9, {
   3.784209901694322*^9, 3.78421003652722*^9}, {3.784232909307127*^9, 
   3.784233039665868*^9}, {3.784233185526812*^9, 3.784233186134468*^9}, 
   3.784272268833633*^9, {3.784324592200713*^9, 3.7843245926023293`*^9}, {
   3.784324673477758*^9, 3.784324728546877*^9}, {3.7845032213785477`*^9, 
   3.7845032562741623`*^9}, {3.784503395684141*^9, 3.784503396034971*^9}, {
   3.7845038561651487`*^9, 3.7845038580124483`*^9}, {3.784503890732806*^9, 
   3.784503918428514*^9}, {3.7845039636048326`*^9, 3.784504005788919*^9}, {
   3.784504064757366*^9, 3.7845040700929613`*^9}, {3.784509386024934*^9, 
   3.7845093867841387`*^9}, {3.784509604248921*^9, 3.7845096231209373`*^9}, {
   3.784537927312314*^9, 3.784537961272463*^9}, {3.78453799822388*^9, 
   3.784538007373623*^9}, {3.784538062678565*^9, 3.784538067117126*^9}, {
   3.784538266361148*^9, 3.7845383039051733`*^9}, {3.784538396272394*^9, 
   3.784538426345519*^9}, {3.784538993764287*^9, 3.784539018408265*^9}, {
   3.784568405452704*^9, 3.784568407792598*^9}, {3.784715390858243*^9, 
   3.7847153924585133`*^9}, {3.78471683362046*^9, 3.7847168436263113`*^9}, {
   3.784716903188966*^9, 3.784716921625555*^9}, 3.784717281746583*^9, {
   3.7847173768069677`*^9, 3.784717408456686*^9}, {3.7847174977041492`*^9, 
   3.784717522902252*^9}, {3.7847186319012413`*^9, 3.784718738744055*^9}, {
   3.784718838236656*^9, 3.784718905184029*^9}, {3.784719053219818*^9, 
   3.784719054056011*^9}, {3.7847191084498787`*^9, 3.7847191459030037`*^9}, {
   3.784941022132285*^9, 3.78494102251084*^9}, {3.7849412765021887`*^9, 
   3.78494131714203*^9}, {3.7849413645605392`*^9, 3.7849413647108793`*^9}, {
   3.784941472625791*^9, 3.784941514335586*^9}, {3.7869946591552343`*^9, 
   3.7869946768549232`*^9}},
 CellLabel->"In[31]:=",ExpressionUUID->"a06758f4-cc0e-4e2e-aa54-8926470916f0"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Plot level sets with respect  to volume parameter", "Chapter",
 CellChangeTimes->{{3.786994697078731*^9, 
  3.786994744285742*^9}},ExpressionUUID->"3969e052-2f3a-4c89-832d-\
b0f3d5fbb233"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"u\[Nu]", "=", 
   RowBox[{"interpolate", "[", 
    RowBox[{"\[Nu]s", ",", "us"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Nu]Min", "=", 
   RowBox[{"Min", "[", "\[Nu]s", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"\[Nu]Max", "=", 
  RowBox[{"Max", "[", "\[Nu]s", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"Plot", "[", 
  RowBox[{
   RowBox[{"u\[Nu]", "[", "\[Nu]", "]"}], ",", 
   RowBox[{"{", 
    RowBox[{"\[Nu]", ",", "\[Nu]Min", ",", "\[Nu]Max"}], "}"}]}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Nu]Count", "=", "90"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Nu]us", "=", 
   RowBox[{"u\[Nu]", "[", 
    RowBox[{"Table", "[", 
     RowBox[{"\[Nu]", ",", 
      RowBox[{"{", 
       RowBox[{"\[Nu]", ",", "\[Nu]Min", ",", "\[Nu]Max", ",", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"\[Nu]Max", "-", "\[Nu]Min"}], ")"}], "/", 
         RowBox[{"(", 
          RowBox[{"\[Nu]Count", "-", "1"}], ")"}]}]}], "}"}]}], "]"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{"aa", ",", "bb", ",", "cc"}], "}"}], "=", 
   RowBox[{"getLevelSetsV2", "[", 
    RowBox[{"\[Phi]", ",", "mesh", ",", "\[Nu]us"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"ListPlot", "[", 
  RowBox[{"cc", ",", 
   RowBox[{"Joined", "\[Rule]", "True"}], ",", 
   RowBox[{"PlotStyle", "\[Rule]", 
    RowBox[{"Directive", "[", 
     RowBox[{
      RowBox[{"Thickness", "[", ".001", "]"}], ",", "Black"}], "]"}]}]}], 
  "]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.786994746567258*^9, 3.786994751894434*^9}, {
   3.78699479613603*^9, 3.786994841607532*^9}, {3.7869948723060627`*^9, 
   3.786994991952174*^9}, {3.786995022778908*^9, 3.786995155326852*^9}, {
   3.786995361920998*^9, 3.786995407025638*^9}, {3.7869954773136187`*^9, 
   3.786995560487402*^9}, 3.786995593636753*^9, {3.786995631726324*^9, 
   3.786995701376451*^9}, {3.78699574199512*^9, 3.786995787951605*^9}, {
   3.78699582004305*^9, 3.7869958351625423`*^9}, {3.786995913377283*^9, 
   3.786995945769702*^9}},
 CellLabel->
  "In[206]:=",ExpressionUUID->"d0c9dcfc-7728-4918-b8f1-de0a4616d70a"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Solve full heat equation", "Chapter",
 CellChangeTimes->{{3.7847169623684*^9, 
  3.78471697994383*^9}},ExpressionUUID->"5c571dad-e96c-49f5-a6e5-\
da3b7483e52e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"tMax", "=", "5"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"H", "=", 
    RowBox[{"jumpFunction", "[", 
     RowBox[{".4", ",", ".6"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"H", "=", 
     RowBox[{"bumpFunction", "[", 
      RowBox[{".2", ",", ".5", ",", "1"}], "]"}]}], ";"}], 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"lft", " ", "=", 
   RowBox[{
    RowBox[{"ex", "[", 
     RowBox[{"[", "1", "]"}], "]"}], "\[Equal]", "0"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"rgt", "=", 
   RowBox[{
    RowBox[{"ex", "[", 
     RowBox[{"[", "2", "]"}], "]"}], "\[Equal]", "0"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"bc1", "=", 
   RowBox[{"DirichletCondition", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"\[Psi]", "[", 
       RowBox[{"t", ",", "x", ",", "y"}], "]"}], "\[Equal]", "0"}], ",", 
     "lft"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"bc2", "=", 
   RowBox[{"DirichletCondition", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"\[Psi]", "[", 
       RowBox[{"t", ",", "x", ",", "y"}], "]"}], "\[Equal]", "0"}], ",", 
     "rgt"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"P", "=", 
   RowBox[{"NDSolveValue", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"HeatEquation", ",", " ", 
       RowBox[{
        RowBox[{"\[Psi]", "[", 
         RowBox[{"0", ",", "x", ",", "y"}], "]"}], "\[Equal]", 
        RowBox[{"H", "[", 
         RowBox[{"\[Phi]", "[", 
          RowBox[{"x", ",", "y"}], "]"}], "]"}]}], ",", "bc1", ",", "bc2"}], 
      "}"}], ",", " ", "\[Psi]", ",", " ", 
     RowBox[{"{", 
      RowBox[{"t", ",", "0", ",", "tMax"}], "}"}], ",", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"x", ",", " ", "y"}], "}"}], " ", "\[Element]", " ", 
      "mesh"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"frames", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"Plot3D", "[", 
      RowBox[{
       RowBox[{"P", "[", 
        RowBox[{"t", ",", "x", ",", "y"}], "]"}], ",", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x", ",", "y"}], "}"}], "\[Element]", "mesh"}], ",", 
       RowBox[{"PlotRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1.1"}], "}"}]}], ",", 
       RowBox[{"Mesh", "\[Rule]", "None"}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"t", ",", "0", ",", "0.25", ",", ".0025"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"ListAnimate", "[", 
  RowBox[{"frames", ",", 
   RowBox[{"SaveDefinitions", "\[Rule]", "False"}], ",", 
   RowBox[{"AnimationRunning", "\[Rule]", "False"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.784717082542037*^9, 3.784717118937154*^9}, 
   3.784717156868415*^9, {3.784941564197536*^9, 3.784941620177603*^9}, {
   3.7849416569755163`*^9, 3.784941657267933*^9}},
 CellLabel->
  "In[693]:=",ExpressionUUID->"9c2dacf1-7c1d-4239-9c3d-cdae5450e975"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"W", "[", "t_", "]"}], ":=", 
   RowBox[{"Function", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x", ",", "y"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"P", "[", 
         RowBox[{"t", ",", "x", ",", "y"}], "]"}], 
        RowBox[{
         RowBox[{"\[Phi]x", "[", 
          RowBox[{"x", ",", "y"}], "]"}], "/", 
         RowBox[{"g\[Phi]Sq", "[", 
          RowBox[{"x", ",", "y"}], "]"}]}]}], ",", 
       RowBox[{
        RowBox[{"P", "[", 
         RowBox[{"t", ",", "x", ",", "y"}], "]"}], 
        RowBox[{
         RowBox[{"\[Phi]y", "[", 
          RowBox[{"x", ",", "y"}], "]"}], "/", 
         RowBox[{"g\[Phi]Sq", "[", 
          RowBox[{"x", ",", "y"}], "]"}]}]}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"pf", "[", "t_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "ps", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ps", "=", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"fieldFlux", "[", 
           RowBox[{"W", "[", "t", "]"}], "]"}], "/@", "Sus"}], ")"}], "/", 
        "\[Sigma]s"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"interpolate", "[", 
       RowBox[{"us", ",", "ps"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pfs", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"pf", "[", "t", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"t", ",", "0", ",", "0.25", ",", ".0025"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"frames", " ", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"Plot", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"pfs", "[", 
         RowBox[{"[", "i", "]"}], "]"}], "[", "u", "]"}], ",", "uDomain", ",", 
       RowBox[{"PlotRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1.1"}], "}"}]}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "pfs", "]"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"ListAnimate", "[", 
  RowBox[{"frames", ",", 
   RowBox[{"SaveDefinitions", "\[Rule]", "False"}], ",", 
   RowBox[{"AnimationRunning", "\[Rule]", "False"}]}], 
  "]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.78450348950865*^9, 3.784503793316482*^9}, {
   3.7845041607650957`*^9, 3.784504289005167*^9}, {3.784504348622259*^9, 
   3.7845044237178583`*^9}, {3.784504501400099*^9, 3.784504507791213*^9}, {
   3.784504589318783*^9, 3.784504647886458*^9}, {3.784504720391053*^9, 
   3.78450485123952*^9}, {3.7845049102646503`*^9, 3.7845049581276484`*^9}, {
   3.78450498868123*^9, 3.784505034144031*^9}, {3.7845050839923897`*^9, 
   3.784505126768141*^9}, 3.7845051726327467`*^9, {3.784505218080535*^9, 
   3.7845053369366827`*^9}, {3.7845054635943108`*^9, 
   3.7845054660171013`*^9}, {3.7845058866360598`*^9, 3.784505886715263*^9}, 
   3.7845068059195623`*^9, {3.7845400667790337`*^9, 3.784540071387569*^9}, 
   3.784717176749009*^9},
 CellLabel->
  "In[702]:=",ExpressionUUID->"d46a9811-1be2-47c4-986a-509c61c3e1d4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"p0", "=", 
   RowBox[{"pfs", "[", 
    RowBox[{"[", "1", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"eq", " ", "=", " ", 
    RowBox[{
     RowBox[{
      RowBox[{"D", "[", 
       RowBox[{
        RowBox[{"\[Psi]", "[", 
         RowBox[{"t", ",", "u"}], "]"}], ",", "t"}], "]"}], "-", 
      RowBox[{"J", " ", 
       RowBox[{
        RowBox[{"D", "[", 
         RowBox[{
          RowBox[{"\[Psi]", "[", 
           RowBox[{"t", ",", "u"}], "]"}], ",", "u", ",", "u"}], "]"}], "/", 
        RowBox[{"\[Sigma]", "[", "u", "]"}]}]}]}], "\[Equal]", "0"}]}], ";"}],
   "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"sol", "=", 
   RowBox[{"NDSolve", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"eq", ",", 
       RowBox[{
        RowBox[{"\[Psi]", "[", 
         RowBox[{"0", ",", "u"}], "]"}], "\[Equal]", 
        RowBox[{"p0", "[", "u", "]"}]}], ",", 
       RowBox[{
        RowBox[{"\[Psi]", "[", 
         RowBox[{"t", ",", "0"}], "]"}], "\[Equal]", "0"}], ",", 
       RowBox[{
        RowBox[{"\[Psi]", "[", 
         RowBox[{"t", ",", "1"}], "]"}], "\[Equal]", "0"}]}], "}"}], ",", 
     "\[Psi]", ",", 
     RowBox[{"{", 
      RowBox[{"t", ",", "0", ",", "tMax"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"u", ",", "0", ",", "1"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"p", "=", 
   RowBox[{"\[Psi]", "/.", 
    RowBox[{"sol", "[", 
     RowBox[{"[", "1", "]"}], "]"}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"frames", " ", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{"Plot", "[", 
      RowBox[{
       RowBox[{"p", "[", 
        RowBox[{"t", ",", "u"}], "]"}], ",", "uDomain", ",", 
       RowBox[{"PlotRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"0", ",", "1.1"}], "}"}]}]}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"t", ",", "0", ",", ".25", ",", ".0025"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"ListAnimate", "[", 
  RowBox[{"frames", ",", 
   RowBox[{"SaveDefinitions", "\[Rule]", "False"}], ",", 
   RowBox[{"AnimationRunning", "\[Rule]", "False"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.7844654810702267`*^9, 3.784465762000448*^9}, {
   3.784469809806012*^9, 3.784469859675982*^9}, 3.784470756998826*^9, {
   3.784470825126581*^9, 3.78447089421939*^9}, {3.784470931252749*^9, 
   3.784471060297845*^9}, {3.7844712992211637`*^9, 3.78447132722606*^9}, {
   3.784471362176938*^9, 3.784471365865034*^9}, {3.784471465939334*^9, 
   3.784471569232469*^9}, {3.784471636043014*^9, 3.784471658167761*^9}, {
   3.7844717053777323`*^9, 3.7844717077864017`*^9}, {3.784471743607647*^9, 
   3.784471763191702*^9}, {3.784471863963107*^9, 3.784471897736519*^9}, {
   3.784472000451611*^9, 3.784472046441153*^9}, {3.784472150997176*^9, 
   3.784472297409606*^9}, {3.7844723550771847`*^9, 3.7844723698338327`*^9}, {
   3.7844724494211397`*^9, 3.7844724945311747`*^9}, {3.784472545963532*^9, 
   3.784472658841543*^9}, {3.784472693834687*^9, 3.7844727170016947`*^9}, {
   3.784472749673699*^9, 3.7844727892020597`*^9}, {3.7844728891163597`*^9, 
   3.784472894780612*^9}, {3.784481817494813*^9, 3.7844818504921293`*^9}, {
   3.784481962779508*^9, 3.784482022827471*^9}, {3.78448205508288*^9, 
   3.784482294619762*^9}, {3.784482512572497*^9, 3.7844825140851507`*^9}, {
   3.7844825659947844`*^9, 3.784482567640877*^9}, 3.784503460355769*^9, {
   3.784505517297237*^9, 3.784505543953712*^9}, {3.7845056571719646`*^9, 
   3.784505680948539*^9}, {3.784505733890933*^9, 3.784505851891726*^9}, {
   3.784505890675644*^9, 3.7845058907632933`*^9}, {3.784540180090626*^9, 
   3.78454019020159*^9}, {3.7847162370895042`*^9, 3.784716285806155*^9}, 
   3.784716332016378*^9, {3.784717854923951*^9, 3.784717858491344*^9}},
 CellLabel->"In[707]:=",
 CellID->1455582224,ExpressionUUID->"bc009c3e-98a0-434b-b823-56f195e4e2e4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"\[Delta]s", "=", 
   RowBox[{"Table", "[", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{"pf", "[", "t", "]"}], "[", "us", "]"}], "-", 
      RowBox[{"p", "[", 
       RowBox[{"t", ",", "us"}], "]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"t", ",", "0", ",", ".25", ",", ".0025"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Delta]Max", "=", 
   RowBox[{"Max", "[", "\[Delta]s", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Delta]Min", "=", 
   RowBox[{"Min", "[", "\[Delta]s", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Print", "[", 
   RowBox[{
   "\"\<Min delta = \>\"", ",", "\[Delta]Min", ",", "\"\<, Max delta = \>\"", 
    ",", "\[Delta]Max"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"frames", "=", 
   RowBox[{"Table", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Show", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"ListPlot", "[", 
        RowBox[{
         RowBox[{"Transpose", "[", 
          RowBox[{"{", 
           RowBox[{"us", ",", 
            RowBox[{"\[Delta]s", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], "}"}], "]"}], ",", 
         RowBox[{"Joined", "\[Rule]", "True"}], ",", 
         RowBox[{"PlotRange", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{"\[Delta]Max", ",", "\[Delta]Min"}], "}"}]}]}], "]"}], ",",
        "\[IndentingNewLine]", 
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"Max", "[", 
          RowBox[{"\[Delta]s", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", "uDomain", ",", 
         RowBox[{"PlotStyle", "\[Rule]", 
          RowBox[{"Directive", "[", 
           RowBox[{"Blue", ",", "Medium", ",", "Dashed"}], "]"}]}]}], "]"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{"Plot", "[", 
        RowBox[{
         RowBox[{"Min", "[", 
          RowBox[{"\[Delta]s", "[", 
           RowBox[{"[", "i", "]"}], "]"}], "]"}], ",", "uDomain", ",", 
         RowBox[{"PlotStyle", "\[Rule]", 
          RowBox[{"Directive", "[", 
           RowBox[{"Red", ",", "Medium", ",", "Dashed"}], "]"}]}]}], "]"}]}], 
      "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"i", ",", "1", ",", 
       RowBox[{"Length", "[", "\[Delta]s", "]"}]}], "}"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"ListAnimate", "[", 
  RowBox[{"frames", ",", 
   RowBox[{"SaveDefinitions", "\[Rule]", "False"}], ",", 
   RowBox[{"AnimationRunning", "\[Rule]", "False"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.784508345790827*^9, 3.7845083801565313`*^9}, {
  3.784508468158749*^9, 3.784508591974868*^9}, {3.7845086551427307`*^9, 
  3.7845087431580057`*^9}, {3.784508827111899*^9, 3.78450882792054*^9}, {
  3.784540196513629*^9, 3.784540199488338*^9}},
 CellLabel->
  "In[713]:=",ExpressionUUID->"137ae255-4817-4f5b-ad59-9732121bccf5"],

Cell[BoxData[
 RowBox[{"\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"frames", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"Show", "[", 
        RowBox[{"lG", ",", 
         RowBox[{"ListPlot", "[", 
          RowBox[{
           RowBox[{"Sus", "[", 
            RowBox[{"[", "i", "]"}], "]"}], ",", 
           RowBox[{"Joined", "\[Rule]", "True"}]}], "]"}], ",", 
         RowBox[{"Axes", "\[Rule]", "False"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", 
         RowBox[{"Length", "[", "Sus", "]"}]}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"ListAnimate", "[", 
    RowBox[{"frames", ",", 
     RowBox[{"SaveDefinitions", "\[Rule]", "False"}], ",", 
     RowBox[{"AnimationRunning", "\[Rule]", "False"}]}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.784717949009348*^9, 3.7847180292468452`*^9}, {
  3.7847180896603928`*^9, 3.784718142872373*^9}, {3.7847182405802794`*^9, 
  3.784718308288316*^9}, {3.78471840173558*^9, 
  3.7847184040335484`*^9}},ExpressionUUID->"598e8f81-a313-4f7d-a71f-\
abf3f19cb54c"],

Cell[BoxData[
 RowBox[{"Plot", "[", 
  RowBox[{
   RowBox[{"\[Sigma]", "[", "u", "]"}], ",", "uDomain", ",", 
   RowBox[{"PlotRange", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"0", ",", "1"}], "}"}]}]}], "]"}]], "Input",
 CellChangeTimes->{{3.784718466880351*^9, 3.784718555288241*^9}},
 CellLabel->
  "In[113]:=",ExpressionUUID->"4d9706d3-fde1-434a-b3f5-5a5b6bca4a71"],

Cell[BoxData["uDomain"], "Input",
 CellChangeTimes->{{3.784718540092866*^9, 3.7847185412493877`*^9}},
 CellLabel->
  "In[111]:=",ExpressionUUID->"388ed480-0000-45b0-8179-894f338d96ef"],

Cell[BoxData[
 RowBox[{"Plot", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\[Sigma]", "[", "u", "]"}], ",", 
     RowBox[{"l", "[", "u", "]"}]}], "}"}], ",", "uDomain", ",", 
   RowBox[{"PlotRange", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"0", ",", "1"}], "}"}]}]}], "]"}]], "Input",
 CellChangeTimes->{{3.784718583526568*^9, 3.784718611311121*^9}},
 CellLabel->
  "In[118]:=",ExpressionUUID->"580ad831-737e-4fe6-8074-3f0ce74365d5"],

Cell[BoxData[
 RowBox[{"Max", "[", 
  RowBox[{"0", ",", "1"}], "]"}]], "Input",
 CellChangeTimes->{{3.784718716886444*^9, 3.784718718848536*^9}},
 CellLabel->
  "In[163]:=",ExpressionUUID->"7009a2c9-c136-4b4d-88e4-3f120fe0de27"]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1280, 1385},
WindowMargins->{{0, Automatic}, {0, Automatic}},
Magnification:>1.25 Inherited,
FrontEndVersion->"13.0 for Mac OS X ARM (64-bit) (February 4, 2022)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"ec511265-4600-46c5-a65d-572170c6bcae"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 191, 3, 123, "Title",ExpressionUUID->"86c4c0b2-3f54-4eda-bbad-517274eb7bb9"],
Cell[774, 27, 786, 17, 90, "Input",ExpressionUUID->"4146c56b-6109-4f1d-bc55-ce221a744420"],
Cell[CellGroupData[{
Cell[1585, 48, 241, 4, 86, "Chapter",ExpressionUUID->"319bfe9c-5b5b-46fb-93fc-c56fe8db3e2e"],
Cell[1829, 54, 18722, 391, 896, "Input",ExpressionUUID->"348b3181-cd68-4997-9e0c-52fee9878f96"],
Cell[20554, 447, 279, 5, 37, "Input",ExpressionUUID->"c899a049-9595-4588-8a25-007a50fbb0a3"]
}, Open  ]],
Cell[CellGroupData[{
Cell[20870, 457, 181, 3, 86, "Chapter",ExpressionUUID->"e3f1f768-6778-468d-95cc-d4f372f10f4d"],
Cell[21054, 462, 1247, 29, 142, "Input",ExpressionUUID->"68c1bf9b-3f72-46ff-b1ad-edb5a213e6ea"]
}, Open  ]],
Cell[CellGroupData[{
Cell[22338, 496, 199, 3, 86, "Chapter",ExpressionUUID->"8ba35778-5ed7-4261-a28b-eb791355ca7e"],
Cell[22540, 501, 5297, 131, 324, "Input",ExpressionUUID->"a06758f4-cc0e-4e2e-aa54-8926470916f0"]
}, Open  ]],
Cell[CellGroupData[{
Cell[27874, 637, 194, 3, 86, "Chapter",ExpressionUUID->"3969e052-2f3a-4c89-832d-b0f3d5fbb233"],
Cell[28071, 642, 2217, 55, 246, "Input",ExpressionUUID->"d0c9dcfc-7728-4918-b8f1-de0a4616d70a"]
}, Open  ]],
Cell[CellGroupData[{
Cell[30325, 702, 166, 3, 86, "Chapter",ExpressionUUID->"5c571dad-e96c-49f5-a6e5-da3b7483e52e"],
Cell[30494, 707, 2998, 87, 272, "Input",ExpressionUUID->"9c2dacf1-7c1d-4239-9c3d-cdae5450e975"],
Cell[33495, 796, 3204, 85, 246, "Input",ExpressionUUID->"d46a9811-1be2-47c4-986a-509c61c3e1d4"],
Cell[36702, 883, 3932, 90, 194, "Input",ExpressionUUID->"bc009c3e-98a0-434b-b823-56f195e4e2e4",
 CellID->1455582224],
Cell[40637, 975, 2952, 73, 350, "Input",ExpressionUUID->"137ae255-4817-4f5b-ad59-9732121bccf5"],
Cell[43592, 1050, 1094, 27, 90, "Input",ExpressionUUID->"598e8f81-a313-4f7d-a71f-abf3f19cb54c"],
Cell[44689, 1079, 370, 9, 37, "Input",ExpressionUUID->"4d9706d3-fde1-434a-b3f5-5a5b6bca4a71"],
Cell[45062, 1090, 184, 3, 37, "Input",ExpressionUUID->"388ed480-0000-45b0-8179-894f338d96ef"],
Cell[45249, 1095, 452, 12, 37, "Input",ExpressionUUID->"580ad831-737e-4fe6-8074-3f0ce74365d5"],
Cell[45704, 1109, 228, 5, 37, "Input",ExpressionUUID->"7009a2c9-c136-4b4d-88e4-3f120fe0de27"]
}, Open  ]]
}, Open  ]]
}
]
*)

